<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">
  <title>All Books</title>
</head>
<body>
<%- include('./partials/nav.ejs') %>
<hr>

<table class="table">
  <thead>
  <tr>
    <th scope="col">#</th>
    <th scope="col">Name</th>
    <th scope="col">Author</th>
    <th scope="col">ISBN</th>
    <th scope="col">Price</th>
    <th scope="col">Amount</th>
  </tr>
  </thead>
  <tbody>
  <% if (books.length) { %>
    <% books.forEach(({ id, name, author, isbn, price, amt }) => { %>
      <tr>
        <th scope="row"><%= id %></th>
        <td><%= name %></td>
        <td><%= author %></td>
        <td><%= isbn %></td>
        <td><%= price %></td>
        <td><%= amt %></td>
        <td>
          <a href="/editBook/<%= id %>" class="btn-edit">
              <i class="bi bi-pencil" ></i>
          </a>
        </td>
        <td>
          <button class="btn-delete" data-id="<%= id %>">
            <i class="bi bi-trash" data-id="<%= id %>"></i>
          </button>
        </td>

      </tr>
    <% }) %>
  <% } %>
  </tbody>
</table>

<script>
  document.addEventListener('click', (e) =>{
    console.log("deleted");
    const id = e.target?.dataset?.id || null;
    if(id){
      fetch(`/${id}`, {
        method: 'DELETE'
      }).then(() => {
        window.location.reload();
      });
    }
  });
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>

</body>
</html>